<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.phgym.mypage.model.MypageMapper">
	<insert id="doCheckin" parameterType="int">
		insert into checkin_his values (#{sessionUserNo}, sysdate)
	</insert>
	
	<select id="checkCheckin" parameterType="int" resultType="int">
		select count(*) from checkin_his where user_no = #{sessionUserNo} and trunc(checkin_date) = trunc(sysdate)
	</select>
	
	<insert id="doTransfer" parameterType="com.phgym.mypage.model.MembershipPayHisDTO">
		insert into membership_pay_his(membership_pay_no, user_no, end_date, remark_transfer_status, remark_transfer_date, remark_pay_no)
		values(membership_pay_his_seq.nextval, #{userNo}, #{endDate}, 'R', sysdate, #{membershipPayNo})
	</insert>
	
	<update id="updateRemarkTransferState" parameterType="com.phgym.mypage.model.MembershipPayHisDTO">
		update membership_pay_his set remark_transfer_status = 'G' where membership_pay_no = #{membershipPayNo} and user_no = #{userNo}
	</update>
	
	<select id="selectEndDate">
		select end_date from membership_pay_his where membership_pay_no = #{membershipPayNo}
	</select>
	
	<select id="checkTransfer" parameterType="int" resultType="com.phgym.mypage.model.MembershipPayHisDTO">
		select * from membership_pay_his where user_no = #{sessionUserNo} and remark_transfer_status is null order by membership_pay_no
	</select>
</mapper>